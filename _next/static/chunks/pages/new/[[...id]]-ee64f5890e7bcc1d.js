(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[378],{7292:(e,o,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/new/[[...id]]",function(){return r(6549)}])},141:(e,o,r)=>{"use strict";r.d(o,{A:()=>t});class t{static ParseFromRecipe(e){return e.map(e=>new t(e.name,e.ingredients,e.howToPrepare))}constructor(e,o,r){this.title="",this.ingredients="",this.instructions="",this.id=0,this.title=e,this.ingredients=o,this.instructions=r}}},6549:(e,o,r)=>{"use strict";let t;r.r(o),r.d(o,{default:()=>h});var n=r(4848),s=r(6715),a=r(6540),l=r(9028),c=r(141);let i="imagesDatabase",d="images";function u(e){e.onupgradeneeded=()=>{t=e.result,console.log("openImageDatabase:onupgradeneeded"),t.objectStoreNames.contains(d)||t.createObjectStore(d,{keyPath:"id",autoIncrement:!0})},e.onerror=()=>{console.error("Image Database Error",e.error)},e.onblocked=()=>{alert("Banco de dados de imagens bloqueado")}}function m(){t.onversionchange=()=>{console.log("openImageDatabase:onversionchange"),null!=t&&(t.close(),alert("Banco de dados de imagens desatualizado. Atualize a p\xe1gina."))}}class g{getById(e){console.log("getById called");let o=indexedDB.open(i,1);return u(o),new Promise((r,n)=>{o.onsuccess=()=>{t=o.result,console.log("success openning image database"),m();let s=t.transaction(d),a=s.objectStore(d).get(Number(e));console.log("getAll request: ".concat(a)),a.onerror=()=>n(a.error),a.onsuccess=()=>{r(a.result)},s.oncomplete=()=>{console.log("getAll result: ".concat(a.result)),t.close()}}})}create(e){let o=indexedDB.open(i,1);return u(o),new Promise((r,n)=>{o.onsuccess=()=>{t=o.result,m();let s=t.transaction(d,"readwrite"),a=s.objectStore(d);console.debug("image to be saved: ".concat(e));let l=a.put(e);l.onsuccess=()=>{let e=l.result;console.log("imagem adicionada com sucesso",e),r(e.toString())},l.onerror=()=>{console.log("erro ao adicionar imagem",l.error),n(l.result)},s.oncomplete=()=>t.close()}})}delete(e){let o=indexedDB.open(i,1);u(o),o.onsuccess=()=>{t=o.result,m();let r=t.transaction(d,"readwrite"),n=r.objectStore(d);console.log("image id to be deleted: ".concat(e));let s=n.delete(e);s.onsuccess=()=>console.log("deletado com sucesso",s.result),s.onerror=()=>console.log("erro ao deletar",s.error),r.oncomplete=()=>t.close()}}}var p=r(9965),b=r.n(p);function h(){let e=(0,s.useRouter)(),o=(0,a.useMemo)(()=>new l.A,[]),r=(0,a.useMemo)(()=>new g,[]),[t,i]=(0,a.useState)(null),[d,u]=(0,a.useState)({name:"",recipePicture:"",ingredients:"",howToPrepare:""});(0,a.useEffect)(()=>{if(void 0==e.query.id)return;console.log("id received: ".concat(e.query.id));let t=Number(e.query.id);t&&o.getById(t).then(e=>{console.debug("recipe",e),void 0!=e&&(u(e),r.getById(e.recipePicture).then(e=>{if(!e){console.debug("failed to get img");return}i(e)}))})},[e.query.id,o,r]);let m=async n=>{if(n.preventDefault(),void 0===d||""==d.name||""==d.ingredients||""==d.howToPrepare){alert("Erro ao salvar receita.");return}if(t){let e=await r.create(t);d.recipePicture=e}o.create(d),alert("Receita salva com sucesso!"),e.push("/recipes")};return(0,n.jsxs)("div",{className:"d-flex flex-column mx-3",children:[(0,n.jsx)("p",{className:"h1 text-center",children:e.query.id?"".concat(d.name):"Nova Receita"}),!!t&&(0,n.jsx)(b(),{src:URL.createObjectURL(t),width:200,height:200,className:"align-self-center my-4",alt:"RecipeImage"}),(0,n.jsxs)("form",{onSubmit:e=>m(e),className:"form",children:[(0,n.jsxs)("div",{className:"form-input mb-3",children:[(0,n.jsx)("label",{htmlFor:"recipe-name",className:"form-label fw-bold",children:"Nome da Receita"}),(0,n.jsx)("input",{required:!0,type:"text",id:"recipe-name",className:"form-control",value:d.name,onChange:e=>{u({id:d.id,name:e.target.value,recipePicture:d.recipePicture,ingredients:d.ingredients,howToPrepare:d.howToPrepare})}})]}),(0,n.jsxs)("div",{className:"form-input mb-3",children:[(0,n.jsx)("label",{htmlFor:"ingredients",className:"form-label fw-bold",children:"Ingredientes"}),(0,n.jsx)("textarea",{required:!0,id:"ingredients",className:"form-control",value:d.ingredients,onChange:e=>{u({id:d.id,name:d.name,recipePicture:d.recipePicture,ingredients:e.target.value,howToPrepare:d.howToPrepare})}})]}),(0,n.jsxs)("div",{className:"form-input mb-3",children:[(0,n.jsx)("label",{htmlFor:"how-to-prepare",className:"form-label fw-bold",children:"Modo de Preparo"}),(0,n.jsx)("textarea",{required:!0,id:"how-to-prepare",className:"form-control",value:d.howToPrepare,onChange:e=>{u({id:d.id,name:d.name,recipePicture:d.recipePicture,ingredients:d.ingredients,howToPrepare:e.target.value})}})]}),(0,n.jsxs)("div",{className:"form-input mb-3",children:[(0,n.jsx)("label",{htmlFor:"recipe-image",className:"form-label fw-bold",children:"Foto da Receita"}),(0,n.jsx)("input",{required:!0,type:"file",accept:".png .jpeg .jpg",id:"recipe-image",className:"form-control",onChange:e=>i(e.target.files?new Blob([e.target.files[0]],{type:e.target.files[0].type}):null)})]}),(0,n.jsxs)("div",{className:"btn-group",children:[(0,n.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Salvar"}),(0,n.jsx)("button",{className:"btn btn-secondary",type:"reset",children:"Limpar"})]})]}),!!e.query.id&&(0,n.jsx)("button",{className:"btn btn-info indexButton mt-4",onClick:()=>{if(void 0===d||""==d.name||""==d.ingredients||""==d.howToPrepare){alert("Erro ao exportar receita.");return}let e=[];e.push(d);let o=new Blob([JSON.stringify(c.A.ParseFromRecipe(e),null)],{type:"application/json"}),r=URL.createObjectURL(o),t=document.createElement("a");t.href=r,t.download="receita_".concat(d.name,".json"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(r)},children:"Exportar receita"})]})}},9028:(e,o,r)=>{"use strict";let t;r.d(o,{A:()=>c});let n="recipesDatabase",s="recipes";function a(e){e.onupgradeneeded=()=>{t=e.result,console.log("openDatabase:onupgradeneeded"),t.objectStoreNames.contains(s)||t.createObjectStore(s,{keyPath:"id",autoIncrement:!0})},e.onerror=()=>{console.error("Database Error",e.error)},e.onblocked=()=>{alert("Banco de dados bloqueado")}}function l(){t.onversionchange=()=>{console.log("openDatabase:onversionchange"),null!=t&&(t.close(),alert("Banco de dados desatualizado. Atualize a p\xe1gina."))}}class c{getAll(){let e=indexedDB.open(n,1);return a(e),console.log("get all called"),new Promise((o,r)=>{e.onsuccess=()=>{t=e.result,console.log("success openning database"),l();let n=t.transaction(s),a=n.objectStore(s).getAll();console.log("getAll request: ".concat(a)),a.onerror=()=>r(a.error),a.onsuccess=()=>{o(a.result)},n.oncomplete=()=>{console.log("getAll result: ".concat(a.result)),t.close()}}})}getById(e){console.log("getById called");let o=indexedDB.open(n,1);return a(o),new Promise((r,n)=>{o.onsuccess=()=>{t=o.result,console.log("success openning database"),l();let a=t.transaction(s),c=a.objectStore(s).get(e);console.log("getAll request: ".concat(c)),c.onerror=()=>n(c.error),c.onsuccess=()=>{r(c.result)},a.oncomplete=()=>{console.log("getAll result: ".concat(c.result)),t.close()}}})}create(e){let o=indexedDB.open(n,1);a(o),o.onsuccess=()=>{t=o.result,l();let r=t.transaction(s,"readwrite"),n=r.objectStore(s);console.log("recipe to be saved: ".concat(e)),void 0==e.id&&delete e.id;let a=n.put(e);a.onsuccess=()=>console.log("adicionado com sucesso",a.result),a.onerror=()=>console.log("erro ao adicionar",a.error),r.oncomplete=()=>t.close()}}async bulkCreate(e){let o=indexedDB.open(n,1);return a(o),new Promise((r,n)=>{o.onsuccess=()=>{t=o.result,l();let a=t.transaction(s,"readwrite"),c=a.objectStore(s);for(let o of(console.log("recipes to be saved: ".concat(e)),e)){let e=c.put(o);e.onsuccess=()=>r(!0),e.onerror=()=>n(e.error)}a.oncomplete=()=>t.close()}})}delete(e){let o=indexedDB.open(n,1);a(o),o.onsuccess=()=>{t=o.result,l();let r=t.transaction(s,"readwrite"),n=r.objectStore(s);console.log("recipe id to be deleted: ".concat(e));let a=n.delete(e);a.onsuccess=()=>console.log("deletado com sucesso",a.result),a.onerror=()=>console.log("erro ao deletar",a.error),r.oncomplete=()=>t.close()}}}}},e=>{var o=o=>e(e.s=o);e.O(0,[615,636,593,792],()=>o(7292)),_N_E=e.O()}]);